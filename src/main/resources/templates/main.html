<!DOCTYPE html>
<html lang="kr">
<head>
    <title>Main</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <link th:href="@{/css/layout.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/css/contents.css}" rel="stylesheet" type="text/css" />
    <!--[if lte IE 7]>
    <link th:href="@{/css/ie.css}" rel="stylesheet" type="text/css" />
    <![endif]-->

</head>

<body>

<div class="total_wrap iamdistribution">
    <!-- Header Section -->
    <div class="header">
        <div class="header_logo" style="display: flex; width:376px;">
            <a href="#">
                <img src="../img/common/nipa_logo.png" alt="NIPA Logo">
            </a>
            <b style="font-size: 24px; margin-left: 10px; margin-top: 18px;">의약품 이력관리 시스템</b>
        </div>
        <div class="util_wrap">
            <ul>
                <li class="fir_name">
                    <span class="f-light" id="user-name">사용자</span><span>님</span>
                </li>
                <li><a href="#" id="logout-button" class="logout">로그아웃</a></li>
            </ul>
        </div>
    </div>

    <!-- Main Navigation -->
    <div class="sitenav">
        <ul class="sitemenu2nd">
            <li class="sitemenu2nd-list on">
                <div class="sitemenu2nd-txtwrap">
                    <span class="sitemenu2nd-title">회원관리</span>
                    <span class="sitemenu2nd-arrow-up"></span>
                </div>
                <ul class="sitemenu3rd">
                    <li class="sitemenu3rd-list">
                        고객정보변경
                        <span class="right-arrow"></span>
                        <ul class="sitemenu4th">
                            <li class="sitemenu4th-list">
                                <a href="고객관리_고객관리_고객정보변경.html" target="iFrame">고객정보변경</a>
                            </li>
                        </ul>
                    </li>
                    <li class="sitemenu3rd-list">
                        고객유형관리
                        <span class="right-arrow"></span>
                        <ul class="sitemenu4th">
                            <li class="sitemenu4th-list">
                                <a href="고객관리_고객유형관리_휴먼고객관리.html" target="iFrame">휴먼고객관리</a>
                            </li>
                            <li class="sitemenu4th-list">
                                <a href="고객관리_고객유형관리_탈퇴고객관리.html" target="iFrame">탈퇴고객관리</a>
                            </li>
                            <li class="sitemenu4th-list">
                                <a href="고객관리_고객유형관리_약관동의관리.html" target="iFrame">약관동의관리</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li class="sitemenu2nd-list">
                <div class="sitemenu2nd-txtwrap">
                    <span class="sitemenu2nd-title">시스템관리</span>
                    <span class="sitemenu2nd-arrow-up"></span>
                </div>
                <ul class="sitemenu3rd">
                    <li class="sitemenu3rd-list">
                        SR/주문건수
                        <span class="right-arrow"></span>
                        <ul class="sitemenu4th">
                            <li class="sitemenu4th-list">
                                <a href="#">SR 상태</a>
                            </li>
                            <li class="sitemenu4th-list">
                                <a href="#">SR 상태</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </div>

    <!-- Content Area with iframe
    <iframe src="/view/user-list" style="border:0" frameborder="0" width="100%" height="600px;" id="iFrame" name="iFrame"></iframe>
    -->

    <div id="user-list-content">
        <!-- 이곳에 /view/user-list 응답 내용이 표시됩니다. -->
    </div>

    <!-- Footer Section -->
    <div class="footer">
        <div class="frametab-box">
            <div class="frametab">
                <span class="frametab-title">사용자관리</span>
                <button class="frametab-close"><span class="alttxt">close tab</span></button>
            </div>
            <div class="frametab tab-on">
                <span class="frametab-title color-w">고객정보변경</span>
                <button class="frametab-close"><span class="alttxt">close tab</span></button>
            </div>
        </div>
        <div class="tabpage-box">
            <button class="tabpage-btn left">
                <span class=""><span class="alttxt">tab page prev</span></span>
            </button>
            <button class="tabpage-btn right">
                <span class=""><span class="alttxt">tab page next</span></span>
            </button>
        </div>
    </div>

</div>

<!-- Layer Popup -->
<div class="layerpopwrap ac none">
    <div class="layer-header">레이어 팝업</div>
    <div class="contents">
        <!--
        <iframe class="contecnts-frame" src="pattern_00.html"></iframe>
        -->
    </div>
    <br/>
    <span class="btn_basic close-layerpop"><a href="#">닫기</a></span>
</div>

<!-- Scripts-->

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script th:src="@{/js/hana.js}"></script>
<script type="text/javascript">
    $(document).ready(function () {
        // Display the logged-in user’s ID
        var userId = localStorage.getItem('userId'); // Fetch the stored user ID (assuming it's stored in localStorage)

        // If the user is logged in, replace the placeholder with their ID
        if (userId) {
            $('#user-name').text(userId);
        }

        // Logout functionality
        $('#logout-button').click(function (event) {
            event.preventDefault(); // Prevent the default link behavior

            // Clear the JWT token or user session data
            localStorage.removeItem('token');  // Remove the stored JWT token (if using JWT)
            localStorage.removeItem('userId'); // Remove the stored userId

            // Optionally, make a logout API request to the server if needed (not required for JWT)
            // $.post("/api/logout", function() {});

            // Redirect the user to the login page after logging out
            window.location.href = '/view/login';
        });
    });
</script>

<script type="text/javascript">
    $(document).ready(function() {
        // 페이지가 로드되면 자동으로 AJAX 요청을 보내서 /view/user-list 불러오기
        $.ajax({
            url: '/view/user-list',  // 불러올 URL
            type: 'GET',
            success: function(data) {

                // 받은 데이터를 #user-list-content에 삽입
                $('#user-list-content').html(data);

                $('#user-list-content').on('click', 'tr.select', function() {
                    // Extract values from the clicked row's cells
                    const id = $(this).find('td:nth-child(1)').text();
                    const role = $(this).find('td:nth-child(2)').text();
                    const companyType = $(this).find('td:nth-child(3)').text();
                    const companyName = $(this).find('td:nth-child(4)').text();
                    const companyRegNumber = $(this).find('td:nth-child(5)').text();
                    const phoneNumber = $(this).find('td:nth-child(6)').text();
                    const email = $(this).find('td:nth-child(7)').text();
                    const active = $(this).find('td:nth-child(8)').text();
                    const seq = $(this).find('td:nth-child(9)').text();

                    // Update the customer detail section with the clicked row's data
                    $('#user-id').text(id);
                    $('#user-role').text(role);
                    $('#user-companyType').text(companyType);
                    $('#user-companyName').text(companyName);
                    $('#user-companyRegNumber').text(companyRegNumber);
                    $('#user-phoneNumber').text(phoneNumber);
                    $('#user-active').text(active);
                    $('#user-email').val(email);
                    $('#user-seq').val(email);
                });

            },
            error: function() {
                console.log("오류 발생:", textStatus, errorThrown);  // 오류 정보 출력
                alert('데이터를 불러오는 중 오류가 발생했습니다.');
            }
        });

    });

</script>

</body>

</html>
