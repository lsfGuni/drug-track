<!DOCTYPE html>
<html lang="kr">
<head>
    <title>Main</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <link th:href="@{/css/layout.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/css/contents.css}" rel="stylesheet" type="text/css" />
    <!--[if lte IE 7]>
    <link th:href="@{/css/ie.css}" rel="stylesheet" type="text/css" />
    <![endif]-->

</head>

<body>

<div class="total_wrap iamdistribution">
    <!-- Header Section -->
    <div class="header">
        <div class="header_logo" style="display: flex; width:376px;">
            <a href="#">
                <img src="../img/common/nipa_logo.png" alt="NIPA Logo">
            </a>
            <b style="font-size: 24px; margin-left: 10px; margin-top: 18px;">의약품 이력관리 시스템</b>
        </div>
        <div class="util_wrap">
            <ul>
                <li class="fir_name">
                    <span class="f-light" id="user-name">사용자</span><span>님</span>
                </li>
                <li><a href="#" id="logout-button" class="logout">로그아웃</a></li>
            </ul>
        </div>
    </div>

    <!-- Main Navigation -->
    <div class="sitenav">
        <ul class="sitemenu2nd">
            <li class="sitemenu2nd-list on">
                <div class="sitemenu2nd-txtwrap">
                    <span class="sitemenu2nd-title">회원관리</span>
                    <span class="sitemenu2nd-arrow-up"></span>
                </div>
                <ul class="sitemenu3rd">
                    <li class="sitemenu3rd-list">
                        고객정보변경
                        <span class="right-arrow"></span>
                        <ul class="sitemenu4th">
                            <li class="sitemenu4th-list">
                                <a href="고객관리_고객관리_고객정보변경.html" target="iFrame">고객정보변경</a>
                            </li>
                        </ul>
                    </li>
                    <li class="sitemenu3rd-list">
                        고객유형관리
                        <span class="right-arrow"></span>
                        <ul class="sitemenu4th">
                            <li class="sitemenu4th-list">
                                <a href="고객관리_고객유형관리_휴먼고객관리.html" target="iFrame">휴먼고객관리</a>
                            </li>
                            <li class="sitemenu4th-list">
                                <a href="고객관리_고객유형관리_탈퇴고객관리.html" target="iFrame">탈퇴고객관리</a>
                            </li>
                            <li class="sitemenu4th-list">
                                <a href="고객관리_고객유형관리_약관동의관리.html" target="iFrame">약관동의관리</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li class="sitemenu2nd-list">
                <div class="sitemenu2nd-txtwrap">
                    <span class="sitemenu2nd-title">시스템관리</span>
                    <span class="sitemenu2nd-arrow-up"></span>
                </div>
                <ul class="sitemenu3rd">
                    <li class="sitemenu3rd-list">
                        SR/주문건수
                        <span class="right-arrow"></span>
                        <ul class="sitemenu4th">
                            <li class="sitemenu4th-list">
                                <a href="#">SR 상태</a>
                            </li>
                            <li class="sitemenu4th-list">
                                <a href="#">SR 상태</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </div>

    <!-- Content Area with iframe
    <iframe src="/view/user-list" style="border:0" frameborder="0" width="100%" height="600px;" id="iFrame" name="iFrame"></iframe>
    -->

    <div id="user-list-content">
        <!-- 이곳에 /view/user-list 응답 내용이 표시됩니다. -->
    </div>

    <!-- Footer Section -->
    <div class="footer">
        <div class="frametab-box">
            <div class="frametab">
                <span class="frametab-title">사용자관리</span>
                <button class="frametab-close"><span class="alttxt">close tab</span></button>
            </div>
            <div class="frametab tab-on">
                <span class="frametab-title color-w">고객정보변경</span>
                <button class="frametab-close"><span class="alttxt">close tab</span></button>
            </div>
        </div>
        <div class="tabpage-box">
            <button class="tabpage-btn left">
                <span class=""><span class="alttxt">tab page prev</span></span>
            </button>
            <button class="tabpage-btn right">
                <span class=""><span class="alttxt">tab page next</span></span>
            </button>
        </div>
    </div>

</div>

<!-- Layer Popup -->
<div class="layerpopwrap ac none">
    <div class="layer-header">레이어 팝업</div>
    <div class="contents">
        <!--
        <iframe class="contecnts-frame" src="pattern_00.html"></iframe>
        -->
    </div>
    <br/>
    <span class="btn_basic close-layerpop"><a href="#">닫기</a></span>
</div>

<h1>Upload CSV from Java Client</h1>

<!-- 파일 업로드를 트리거하는 버튼 -->
<button id="uploadButton">Upload CSV</button>

<!-- 업로드 상태를 보여줄 영역 -->
<p id="status"></p>

<!-- Scripts-->
<script type="text/javascript">
    document.getElementById('uploadButton').addEventListener('click', function() {
        // GET 요청을 보내서 CSV 파일 업로드 실행
        fetch('http://localhost:8082/api/upload-file-front')
            .then(response => response.text())
            .then(result => {
                document.getElementById('status').textContent = "Upload response: " + result;
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('status').textContent = "Upload failed.";
            });
    });

</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script th:src="@{/js/hana.js}"></script>
<script type="text/javascript">
    $(document).ready(function () {
        // Display the logged-in user’s ID
        var userId = localStorage.getItem('userId'); // Fetch the stored user ID (assuming it's stored in localStorage)

        // If the user is logged in, replace the placeholder with their ID
        if (userId) {
            $('#user-name').text(userId);
        }

        // Logout functionality
        $('#logout-button').click(function (event) {
            event.preventDefault(); // Prevent the default link behavior

            // Clear the JWT token or user session data
            localStorage.removeItem('token');  // Remove the stored JWT token (if using JWT)
            localStorage.removeItem('userId'); // Remove the stored userId

            // Optionally, make a logout API request to the server if needed (not required for JWT)
            // $.post("/api/logout", function() {});

            // Redirect the user to the login page after logging out
            window.location.href = '/view/login';
        });
    });
</script>

<script type="text/javascript">
    $(document).ready(function () {
        // 페이지가 로드되면 AJAX로 첫 번째 페이지를 불러옵니다
        loadUserList(0);

        // 페이지 번호 클릭 시
        $(document).on('click', '.pagination-button', function (event) {
            event.preventDefault();  // 기본 페이지 이동 동작을 막음
            const page = $(this).data('page');  // 클릭된 페이지 번호를 가져옴
            loadUserList(page);
        });
    });

    function loadUserList(page) {
        $.ajax({
            url: '/view/user-list',  // 서버에서 데이터를 불러올 URL
            type: 'GET',
            data: { page: page, size: 10 },  // 필요한 페이지 정보 전송
            success: function (data) {
                // 받은 데이터를 #user-list-content에 삽입
                $('#user-list-content').html(data);

                // 행 클릭 이벤트 바인딩
                // 동적으로 삽입된 테이블 행에도 클릭 이벤트를 바인딩하기 위해
                // 이벤트 위임 방식으로 이벤트를 바인딩함
                bindRowClickEvent();
            },
            error: function () {
                console.log("오류 발생");  // 오류 정보 출력
                alert('데이터를 불러오는 중 오류가 발생했습니다.');
            }
        });
    }

    function bindRowClickEvent() {
        // 이벤트 위임을 통해 동적으로 로드된 테이블의 행에 이벤트를 바인딩합니다.
        // 이 코드는 document에 이벤트를 바인딩하고, 그 안에서 특정 셀렉터가 클릭되었을 때만 이벤트를 트리거합니다.
        $(document).on('click', '#user-list-content tr.select', function () {
            console.log("클릭 이벤트 감지");

            // 각 열에서 데이터를 추출
            const id = $(this).find('td:nth-child(1)').text().trim();
            const role = $(this).find('td:nth-child(2)').text().trim();
            const companyType = $(this).find('td:nth-child(3)').text().trim();
            const companyName = $(this).find('td:nth-child(4)').text().trim();
            const companyRegNumber = $(this).find('td:nth-child(5)').text().trim();
            const phoneNumber = $(this).find('td:nth-child(6)').text().trim();
            const email = $(this).find('td:nth-child(7)').text().trim();
            const active = $(this).find('td:nth-child(8)').text().trim();
            const seq = $(this).find('td:nth-child(9)').text().trim();

            // 추출된 데이터를 디테일 영역에 업데이트
            $('#user-id').text(id);
            $('#user-role').text(role);
            $('#user-companyType').text(companyType);
            $('#user-companyName').text(companyName);
            $('#user-companyRegNumber').text(companyRegNumber);
            $('#user-phoneNumber').text(phoneNumber);
            $('#user-active').text(active);
            $('#user-email').val(email);
            $('#user-seq').val(seq);
        });
    }
</script>


</body>

</html>
